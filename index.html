<!---
* Social Fan Monitor
* Made by Social Fan Team
* https://github.com/Douglasgomestosta/Social-Fan-Monitor
* @license MIT
--->
<html>
<head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<title>Social Fan Status</title>
</head>
<body style="background-color:#212529;">



<!---modal logs-->
<div class="modal fade" id="modal_logs" tabindex="-1" aria-labelledby="modal_logs" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="name_service_modal_logs">xxx</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="body_modal_logs">
        ...
      </div>
    </div>
  </div>
</div>

<!---end modal logs-->

<div style="min-height:100vh;">

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark" aria-label="Tenth navbar example">
        <div class="container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample08" aria-controls="navbarsExample08" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
    
          <div class="collapse navbar-collapse justify-content-md-center" id="navbarsExample08" style="color: #edb3b3;">
            <ul class="navbar-nav">
              <li class="nav-item">
                <img src="https://socialfan.app/estatico/imagens/Logos/socialfan_animated_veryslow.gif">
              </li>
              
            </ul>
          </div>
        </div>
      </nav>


<center id="loading_icon"><div class="spinner-border" role="status" style="color:white;width: 3rem;height: 3rem;font-size: 2rem;"></div></center>

<div class="accordion accordion-flush" id="list_services">

</div>

</div>


<div class="container" style="background-color: white;border-radius: 10px;">
  <footer class="py-3 my-4">

    <ul class="nav justify-content-center border-bottom pb-3 mb-3">
      <li class="nav-item"><a href="https://github.com/Douglasgomestosta/Social-Fan-Monitor" target="_blank" class="nav-link px-2 text-muted">Github</a></li>
      <li class="nav-item"><a href="https://socialfan.app/perfil/SocialFanPT-BR" target="_blank" class="nav-link px-2 text-muted">Follow us on Social Fan</a></li>
    </ul>
    <p class="text-center text-muted">Made with <svg xmlns="http://www.w3.org/2000/svg" color="red" width="16" height="16" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314"/></svg> by Social Fan</p>
  </footer>
</div>


<script>
get_data();
setInterval(get_data,60000);//re-check every 60 seconds
async function get_data(){
document.getElementById('loading_icon').style.display = '';
document.getElementById('list_services').innerHTML = '';
var result = await fetch('../api/get_data', {    
method: 'POST',
headers: {
'Accept': 'application/json',
'Content-Type': 'application/json'
},
body:'{}'
})
document.getElementById('loading_icon').style.display = 'none';
var json = await result.json();
console.log(json);
for await (const item of json){
var id = Math.floor(Math.random() * 10000);
var newDiv = document.createElement("div");
var offline = item.services.filter(function(data){return data.status == 0;});
var online = item.services.filter(function(data){return data.status == 1;});

if(offline.length == item.services.length){
var icon_show = `<div style="background-color:red; width:20px; height:20px;border-radius:20px;margin-right: 5px;"></div>`;
}else{
if(online.length == item.services.length)
{
var icon_show = `<div style="background-color:green; width:20px; height:20px;border-radius:20px;margin-right: 5px;"></div>`;
}else{
var icon_show = `<div style="background-color:yellow; width:20px; height:20px;border-radius:20px;margin-right: 5px;"></div>`;
}
}
newDiv.innerHTML = `
<div class="accordion-item">
<h2 class="accordion-header">
<button style="padding-left: 0.9rem;" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse${id}" aria-expanded="false" aria-controls="flush-collapseOne">
${icon_show}${item.name}
</button>
</h2>
<div id="flush-collapse${id}" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
<div class="accordion-body" style="padding-bottom: 0.5rem;">
</div>
</div>
</div>`

for await (const item_urls of item.services){
var newDiv_inside = document.createElement("div");
switch(item_urls.status){
case 0:
var status_icon = `<div style="background-color:red; width:20px; height:20px;border-radius:20px;margin-right: 5px;display: inline-block;"></div>`;
break;
case 1:
var status_icon = `<div style="background-color:green; width:20px; height:20px;border-radius:20px;margin-right: 5px;display: inline-block;"></div>`;
break;
default:
var status_icon = `<div style="background-color:yellow; width:20px; height:20px;border-radius:20px;margin-right: 5px;display: inline-block;"></div>`;
}
newDiv_inside.innerHTML = `${status_icon} <h6 style="display: inline-block;">${item_urls.name}</h6>`;
newDiv.getElementsByClassName('accordion-body')[0].appendChild(newDiv_inside);
}
var log_button = document.createElement("button");
log_button.className = 'btn btn-outline-primary btn-sm';
log_button.innerHTML = 'Logs';
log_button.style.marginTop = '0.5rem';
log_button.onclick = function() { open_log(item.name); }

newDiv.getElementsByClassName('accordion-body')[0].appendChild(log_button);

document.getElementById('list_services').appendChild(newDiv);  

}

}

async function open_log(name_service){
document.getElementById('name_service_modal_logs').innerHTML = name_service;
new bootstrap.Modal(document.getElementById('modal_logs')).show();
document.getElementById('body_modal_logs').innerHTML = `<center><div class="spinner-border text-primary" role="status"></div></center>`;
var result = await fetch('../api/get_log_data', {    
method: 'POST',
headers: {
'Accept': 'application/json',
'Content-Type': 'application/json'
},
body:JSON.stringify({name:name_service})
})
var json = await result.json();
console.log(json);
if(json.length == 0)
{
document.getElementById('body_modal_logs').innerHTML = `
<center>
<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" color="black" fill="currentColor" class="bi bi-card-list" viewBox="0 0 16 16">  <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2z"/>  <path d="M5 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 5 8m0-2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m0 5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m-1-5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0M4 8a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0m0 2.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0"/></svg>
<h5>There are no logs for this service yet.</h5>
</center>
`;
return;
}
document.getElementById('body_modal_logs').innerHTML = '';
var list = document.createElement("div");
list.innerHTML = `<ol class="list-group list-group-numbered"></ol>`;
const option = {
    year: 'numeric',
    month: ('long' || 'short' || 'numeric'),
    weekday: ('long' || 'short'),
    day: 'numeric',
    hour: 'numeric',
    minute: 'numeric',
    second: 'numeric'
}

for await (const item of json){
var log_item = document.createElement("li");
log_item.className = 'list-group-item d-flex justify-content-between align-items-start';
log_item.innerHTML = `
<div class="ms-2 me-auto">
<div class="fw-bold">${new Date(parseInt(item.date)).toLocaleDateString(undefined,option)}</div>
${item.text}
</div>
<span class="badge text-bg-primary rounded-pill">${item.status}</span>`;
list.getElementsByClassName('list-group')[0].appendChild(log_item);
};


document.getElementById('body_modal_logs').appendChild(list);  


}
</script>

</body>
</html>